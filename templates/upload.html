<!doctype html>
<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
<title>Dog Breed</title>
<script type="text/javascript">
const fileReader = new FileReader();

fileReader.onload = event => {
  const image = new Image();
  image.src = event.target.result;

  image.onload = () => {
      const canvas = document.createElement("canvas");
      canvas.width = image.width / 4;
      canvas.height = image.height / 4;

      const context = canvas.getContext("2d");
      context.drawImage(image, 0, 0, image.width, image.height, 0, 0, canvas.width, canvas.height);
      const compressedImage = canvas.toDataURL("image/jpeg");
      document.getElementById("upload-Preview").src = compressedImage;

      let xhr = new XMLHttpRequest();

      xhr.onreadystatechange = function() {
        if (xhr.readyState == XMLHttpRequest.DONE && xhr.status == 200) {
           document.getElementById("result").innerHTML = xhr.responseText.substring(10).replace('"}', '');
        }
    };

      xhr.open('POST', '/upload');
      xhr.setRequestHeader('Content-Type', 'application/json');
      xhr.send(compressedImage);
  }

};

const loadImageFile = () => {
  let uploadFile = document.getElementById("file").files[0];
  fileReader.readAsDataURL(uploadFile);
}
</script>
</head>

<body>
  <form name="uploadForm" action="/upload" method="post">
    <table>
      <tbody>
        <tr>
          <td><input name="image-file" id="file"  accept="image/*" type="file" onchange=loadImageFile() /></td>
        </tr>
         <tr>
          <td><img id="upload-Preview"/></td>
        </tr>
        <tr>
          <div id="result" />
        </tr>
      </tbody>
    </table>
  </form>
</body>
</html>